import{D as e,H as t,j as n,m as r,n as o,o as i,N as s,p as a,q as l}from"../../../three.module-6Gc0evA5.min.js";import{unzlibSync as c}from"../libs/fflate.module.min.js";class u extends e{constructor(e){super(e),this.type=t}parse(e){const a=65536,u=14,f=65537,h=16384,w=Math.pow(2.7182818,2.2);const p={l:0,c:0,lc:0};function d(e,t,n,r,o){for(;n<e;)t=t<<8|q(r,o),n+=8;n-=e,p.l=t>>n&(1<<e)-1,p.c=t,p.lc=n}const y=new Array(59);function v(e,t,n,r,o,i){const s=t;let a=0,l=0;for(;r<=o;r++){if(s.value-t.value>n)return!1;d(6,a,l,e,s);const c=p.l;if(a=p.c,l=p.lc,i[r]=c,63==c){if(s.value-t.value>n)throw new Error("Something wrong with hufUnpackEncTable");d(8,a,l,e,s);let c=p.l+6;if(a=p.c,l=p.lc,r+c>o+1)throw new Error("Something wrong with hufUnpackEncTable");for(;c--;)i[r++]=0;r--}else if(c>=59){let e=c-59+2;if(r+e>o+1)throw new Error("Something wrong with hufUnpackEncTable");for(;e--;)i[r++]=0;r--}}!function(e){for(let e=0;e<=58;++e)y[e]=0;for(let t=0;t<f;++t)y[e[t]]+=1;let t=0;for(let e=58;e>0;--e){const n=t+y[e]>>1;y[e]=t,t=n}for(let t=0;t<f;++t){const n=e[t];n>0&&(e[t]=n|y[n]++<<6)}}(i)}function S(e){return 63&e}function m(e){return e>>6}const g={c:0,lc:0};function b(e,t,n,r){e=e<<8|q(n,r),t+=8,g.c=e,g.lc=t}const A={c:0,lc:0};function E(e,t,n,r,o,i,s,a,l){if(e==t){r<8&&(b(n,r,o,i),n=g.c,r=g.lc);let e=n>>(r-=8);if(e=new Uint8Array([e])[0],a.value+e>l)return!1;const t=s[a.value-1];for(;e-- >0;)s[a.value++]=t}else{if(!(a.value<l))return!1;s[a.value++]=e}A.c=n,A.lc=r}function U(e){return 65535&e}function M(e){const t=U(e);return t>32767?t-65536:t}const C={a:0,b:0};function z(e,t){const n=M(e),r=M(t),o=n+(1&r)+(r>>1),i=o,s=o-r;C.a=i,C.b=s}function O(e,t){const n=U(e),r=U(t),o=n-(r>>1)&65535,i=r+o-32768&65535;C.a=i,C.b=o}function R(e,t,n,r,o,i,s){const a=s<16384,l=n>o?o:n;let c,u,f=1;for(;f<=l;)f<<=1;for(f>>=1,c=f,f>>=1;f>=1;){u=0;const s=u+i*(o-c),l=i*f,h=i*c,w=r*f,p=r*c;let d,y,v,S;for(;u<=s;u+=h){let o=u;const i=u+r*(n-c);for(;o<=i;o+=p){const n=o+w,r=o+l,i=r+w;a?(z(e[o+t],e[r+t]),d=C.a,v=C.b,z(e[n+t],e[i+t]),y=C.a,S=C.b,z(d,y),e[o+t]=C.a,e[n+t]=C.b,z(v,S),e[r+t]=C.a,e[i+t]=C.b):(O(e[o+t],e[r+t]),d=C.a,v=C.b,O(e[n+t],e[i+t]),y=C.a,S=C.b,O(d,y),e[o+t]=C.a,e[n+t]=C.b,O(v,S),e[r+t]=C.a,e[i+t]=C.b)}if(n&f){const n=o+l;a?z(e[o+t],e[n+t]):O(e[o+t],e[n+t]),d=C.a,e[n+t]=C.b,e[o+t]=d}}if(o&f){let o=u;const i=u+r*(n-c);for(;o<=i;o+=p){const n=o+w;a?z(e[o+t],e[n+t]):O(e[o+t],e[n+t]),d=C.a,e[n+t]=C.b,e[o+t]=d}}c=f,f>>=1}return u}function I(e,t,n,r,o,i){const s=n.value,a=G(t,n),l=G(t,n);n.value+=4;const c=G(t,n);if(n.value+=4,a<0||a>=f||l<0||l>=f)throw new Error("Something wrong with HUF_ENCSIZE");const w=new Array(f),p=new Array(h);!function(e){for(let t=0;t<h;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(p);if(v(e,n,r-(n.value-s),a,l,w),c>8*(r-(n.value-s)))throw new Error("Something wrong with hufUncompress");!function(e,t,n,r){for(;t<=n;t++){const n=m(e[t]),o=S(e[t]);if(n>>o)throw new Error("Invalid table entry");if(o>u){const e=r[n>>o-u];if(e.len)throw new Error("Invalid table entry");if(e.lit++,e.p){const t=e.p;e.p=new Array(e.lit);for(let n=0;n<e.lit-1;++n)e.p[n]=t[n]}else e.p=new Array(1);e.p[e.lit-1]=t}else if(o){let e=0;for(let i=1<<u-o;i>0;i--){const i=r[(n<<u-o)+e];if(i.len||i.p)throw new Error("Invalid table entry");i.len=o,i.lit=t,e++}}}}(w,a,l,p),function(e,t,n,r,o,i,s,a,l){let c=0,f=0;const h=s,w=Math.trunc(r.value+(o+7)/8);for(;r.value<w;)for(b(c,f,n,r),c=g.c,f=g.lc;f>=u;){const o=t[c>>f-u&16383];if(o.len)f-=o.len,E(o.lit,i,c,f,n,r,a,l,h),c=A.c,f=A.lc;else{if(!o.p)throw new Error("hufDecode issues");let t;for(t=0;t<o.lit;t++){const s=S(e[o.p[t]]);for(;f<s&&r.value<w;)b(c,f,n,r),c=g.c,f=g.lc;if(f>=s&&m(e[o.p[t]])==(c>>f-s&(1<<s)-1)){f-=s,E(o.p[t],i,c,f,n,r,a,l,h),c=A.c,f=A.lc;break}}if(t==o.lit)throw new Error("hufDecode issues")}}const p=8-o&7;for(c>>=p,f-=p;f>0;){const e=t[c<<u-f&16383];if(!e.len)throw new Error("hufDecode issues");f-=e.len,E(e.lit,i,c,f,n,r,a,l,h),c=A.c,f=A.lc}}(w,p,e,n,c,l,i,o,{value:0})}function P(e){for(let t=1;t<e.length;t++){const n=e[t-1]+e[t]-128;e[t]=n}}function x(e,t){let n=0,r=Math.floor((e.length+1)/2),o=0;const i=e.length-1;for(;!(o>i||(t[o++]=e[n++],o>i));)t[o++]=e[r++]}function k(e){let t=e.byteLength;const n=new Array;let r=0;const o=new DataView(e);for(;t>0;){const e=o.getInt8(r++);if(e<0){const i=-e;t-=i+1;for(let e=0;e<i;e++)n.push(o.getUint8(r++))}else{const i=e;t-=2;const s=o.getUint8(r++);for(let e=0;e<i+1;e++)n.push(s)}}return n}function N(e,t,n){let r,o=1;for(;o<64;)r=t[e.value],65280==r?o=64:r>>8==255?o+=255&r:(n[o]=r,o++),e.value++}function D(e,t){t[0]=ee(e[0]),t[1]=ee(e[1]),t[2]=ee(e[5]),t[3]=ee(e[6]),t[4]=ee(e[14]),t[5]=ee(e[15]),t[6]=ee(e[27]),t[7]=ee(e[28]),t[8]=ee(e[2]),t[9]=ee(e[4]),t[10]=ee(e[7]),t[11]=ee(e[13]),t[12]=ee(e[16]),t[13]=ee(e[26]),t[14]=ee(e[29]),t[15]=ee(e[42]),t[16]=ee(e[3]),t[17]=ee(e[8]),t[18]=ee(e[12]),t[19]=ee(e[17]),t[20]=ee(e[25]),t[21]=ee(e[30]),t[22]=ee(e[41]),t[23]=ee(e[43]),t[24]=ee(e[9]),t[25]=ee(e[11]),t[26]=ee(e[18]),t[27]=ee(e[24]),t[28]=ee(e[31]),t[29]=ee(e[40]),t[30]=ee(e[44]),t[31]=ee(e[53]),t[32]=ee(e[10]),t[33]=ee(e[19]),t[34]=ee(e[23]),t[35]=ee(e[32]),t[36]=ee(e[39]),t[37]=ee(e[45]),t[38]=ee(e[52]),t[39]=ee(e[54]),t[40]=ee(e[20]),t[41]=ee(e[22]),t[42]=ee(e[33]),t[43]=ee(e[38]),t[44]=ee(e[46]),t[45]=ee(e[51]),t[46]=ee(e[55]),t[47]=ee(e[60]),t[48]=ee(e[21]),t[49]=ee(e[34]),t[50]=ee(e[37]),t[51]=ee(e[47]),t[52]=ee(e[50]),t[53]=ee(e[56]),t[54]=ee(e[59]),t[55]=ee(e[61]),t[56]=ee(e[35]),t[57]=ee(e[36]),t[58]=ee(e[48]),t[59]=ee(e[49]),t[60]=ee(e[57]),t[61]=ee(e[58]),t[62]=ee(e[62]),t[63]=ee(e[63])}function _(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),o=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(.981746875),s=.5*Math.cos(3*3.14159/8),a=.5*Math.cos(1.374445625),l=new Array(4),c=new Array(4),u=new Array(4),f=new Array(4);for(let h=0;h<8;++h){const w=8*h;l[0]=r*e[w+2],l[1]=s*e[w+2],l[2]=r*e[w+6],l[3]=s*e[w+6],c[0]=n*e[w+1]+o*e[w+3]+i*e[w+5]+a*e[w+7],c[1]=o*e[w+1]-a*e[w+3]-n*e[w+5]-i*e[w+7],c[2]=i*e[w+1]-n*e[w+3]+a*e[w+5]+o*e[w+7],c[3]=a*e[w+1]-i*e[w+3]+o*e[w+5]-n*e[w+7],u[0]=t*(e[w+0]+e[w+4]),u[3]=t*(e[w+0]-e[w+4]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],f[0]=u[0]+u[1],f[1]=u[3]+u[2],f[2]=u[3]-u[2],f[3]=u[0]-u[1],e[w+0]=f[0]+c[0],e[w+1]=f[1]+c[1],e[w+2]=f[2]+c[2],e[w+3]=f[3]+c[3],e[w+4]=f[3]-c[3],e[w+5]=f[2]-c[2],e[w+6]=f[1]-c[1],e[w+7]=f[0]-c[0]}for(let h=0;h<8;++h)l[0]=r*e[16+h],l[1]=s*e[16+h],l[2]=r*e[48+h],l[3]=s*e[48+h],c[0]=n*e[8+h]+o*e[24+h]+i*e[40+h]+a*e[56+h],c[1]=o*e[8+h]-a*e[24+h]-n*e[40+h]-i*e[56+h],c[2]=i*e[8+h]-n*e[24+h]+a*e[40+h]+o*e[56+h],c[3]=a*e[8+h]-i*e[24+h]+o*e[40+h]-n*e[56+h],u[0]=t*(e[h]+e[32+h]),u[3]=t*(e[h]-e[32+h]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],f[0]=u[0]+u[1],f[1]=u[3]+u[2],f[2]=u[3]-u[2],f[3]=u[0]-u[1],e[0+h]=f[0]+c[0],e[8+h]=f[1]+c[1],e[16+h]=f[2]+c[2],e[24+h]=f[3]+c[3],e[32+h]=f[3]-c[3],e[40+h]=f[2]-c[2],e[48+h]=f[1]-c[1],e[56+h]=f[0]-c[0]}function L(e){for(let t=0;t<64;++t){const n=e[0][t],r=e[1][t],o=e[2][t];e[0][t]=n+1.5747*o,e[1][t]=n-.1873*r-.4682*o,e[2][t]=n+1.8556*r}}function T(e,t,n){for(let r=0;r<64;++r)t[n+r]=l.toHalfFloat(B(e[r]))}function B(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(w,Math.abs(e)-1)}function X(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function V(e){const t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(k(t)),r=new Uint8Array(n.length);return P(n),x(n,r),new DataView(r.buffer)}function F(e){const t=e.array.slice(e.offset.value,e.offset.value+e.size),n=c(t),r=new Uint8Array(n.length);return P(n),x(n,r),new DataView(r.buffer)}function H(e){const t=e.viewer,n={value:e.offset.value},r=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),o=new Uint8Array(8192);let i=0;const s=new Array(e.channels);for(let t=0;t<e.channels;t++)s[t]={},s[t].start=i,s[t].end=s[t].start,s[t].nx=e.width,s[t].ny=e.lines,s[t].size=e.type,i+=s[t].nx*s[t].ny*s[t].size;const l=te(t,n),c=te(t,n);if(c>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(l<=c)for(let e=0;e<c-l+1;e++)o[e+l]=$(t,n);const u=new Uint16Array(a),f=function(e,t){let n=0;for(let r=0;r<a;++r)(0==r||e[r>>3]&1<<(7&r))&&(t[n++]=r);const r=n-1;for(;n<a;)t[n++]=0;return r}(o,u),h=G(t,n);I(e.array,t,n,h,r,i);for(let t=0;t<e.channels;++t){const e=s[t];for(let n=0;n<s[t].size;++n)R(r,e.start+n,e.nx,e.size,e.ny,e.nx*e.size,f)}!function(e,t,n){for(let r=0;r<n;++r)t[r]=e[t[r]]}(u,r,i);let w=0;const p=new Uint8Array(r.buffer.byteLength);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){const e=s[t],n=e.nx*e.size,o=new Uint8Array(r.buffer,2*e.end,2*n);p.set(o,w),w+=2*n,e.end+=n}return new DataView(p.buffer)}function W(e){const t=e.array.slice(e.offset.value,e.offset.value+e.size),n=c(t),r=e.lines*e.channels*e.width,o=1==e.type?new Uint16Array(r):new Uint32Array(r);let i=0,s=0;const a=new Array(4);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:a[0]=i,a[1]=a[0]+e.width,i=a[1]+e.width;for(let r=0;r<e.width;++r){t+=n[a[0]++]<<8|n[a[1]++],o[s]=t,s++}break;case 2:a[0]=i,a[1]=a[0]+e.width,a[2]=a[1]+e.width,i=a[2]+e.width;for(let r=0;r<e.width;++r){t+=n[a[0]++]<<24|n[a[1]++]<<16|n[a[2]++]<<8,o[s]=t,s++}}}return new DataView(o.buffer)}function Z(e){const t=e.viewer,n={value:e.offset.value},r=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),o={version:J(t,n),unknownUncompressedSize:J(t,n),unknownCompressedSize:J(t,n),acCompressedSize:J(t,n),dcCompressedSize:J(t,n),rleCompressedSize:J(t,n),rleUncompressedSize:J(t,n),rleRawSize:J(t,n),totalAcUncompressedCount:J(t,n),totalDcUncompressedCount:J(t,n),acCompression:J(t,n)};if(o.version<2)throw new Error("EXRLoader.parse: "+ae.compression+" version "+o.version+" is unsupported");const i=new Array;let s=te(t,n)-2;for(;s>0;){const e=Y(t.buffer,n),r=$(t,n),o=r>>2&3,a=new Int8Array([(r>>4)-1])[0],l=$(t,n);i.push({name:e,index:a,type:l,compression:o}),s-=e.length+3}const a=ae.channels,l=new Array(e.channels);for(let t=0;t<e.channels;++t){const n=l[t]={},r=a[t];n.name=r.name,n.compression=0,n.decoded=!1,n.type=r.pixelType,n.pLinear=r.pLinear,n.width=e.width,n.height=e.lines}const u={idx:new Array(3)};for(let t=0;t<e.channels;++t){const e=l[t];for(let n=0;n<i.length;++n){const r=i[n];e.name==r.name&&(e.compression=r.compression,r.index>=0&&(u.idx[r.index]=t),e.offset=t)}}let f,h,w;if(o.acCompressedSize>0)switch(o.acCompression){case 0:f=new Uint16Array(o.totalAcUncompressedCount),I(e.array,t,n,o.acCompressedSize,f,o.totalAcUncompressedCount);break;case 1:const r=e.array.slice(n.value,n.value+o.totalAcUncompressedCount),i=c(r);f=new Uint16Array(i.buffer),n.value+=o.totalAcUncompressedCount}if(o.dcCompressedSize>0){const t={array:e.array,offset:n,size:o.dcCompressedSize};h=new Uint16Array(F(t).buffer),n.value+=o.dcCompressedSize}if(o.rleRawSize>0){const t=e.array.slice(n.value,n.value+o.rleCompressedSize);w=k(c(t).buffer),n.value+=o.rleCompressedSize}let p=0;const d=new Array(l.length);for(let e=0;e<d.length;++e)d[e]=new Array;for(let t=0;t<e.lines;++t)for(let t=0;t<l.length;++t)d[t].push(p),p+=l[t].width*e.type*2;!function(e,t,n,r,o,i){let s=new DataView(i.buffer);const a=n[e.idx[0]].width,l=n[e.idx[0]].height,c=Math.floor(a/8),u=Math.ceil(a/8),f=Math.ceil(l/8),h=a-8*(u-1),w=l-8*(f-1),p={value:0},d=new Array(3),y=new Array(3),v=new Array(3),S=new Array(3),m=new Array(3);for(let n=0;n<3;++n)m[n]=t[e.idx[n]],d[n]=n<1?0:d[n-1]+u*f,y[n]=new Float32Array(64),v[n]=new Uint16Array(64),S[n]=new Uint16Array(64*u);for(let t=0;t<f;++t){let i=8;t==f-1&&(i=w);let a=8;for(let e=0;e<u;++e){e==u-1&&(a=h);for(let e=0;e<3;++e)v[e].fill(0),v[e][0]=o[d[e]++],N(p,r,v[e]),D(v[e],y[e]),_(y[e]);L(y);for(let t=0;t<3;++t)T(y[t],S[t],64*e)}let l=0;for(let r=0;r<3;++r){const o=n[e.idx[r]].type;for(let e=8*t;e<8*t+i;++e){l=m[r][e];for(let t=0;t<c;++t){const n=64*t+8*(7&e);s.setUint16(l+0*o,S[r][n+0],!0),s.setUint16(l+2*o,S[r][n+1],!0),s.setUint16(l+4*o,S[r][n+2],!0),s.setUint16(l+6*o,S[r][n+3],!0),s.setUint16(l+8*o,S[r][n+4],!0),s.setUint16(l+10*o,S[r][n+5],!0),s.setUint16(l+12*o,S[r][n+6],!0),s.setUint16(l+14*o,S[r][n+7],!0),l+=16*o}}if(c!=u)for(let e=8*t;e<8*t+i;++e){const t=m[r][e]+8*c*2*o,n=64*c+8*(7&e);for(let e=0;e<a;++e)s.setUint16(t+2*e*o,S[r][n+e],!0)}}}const g=new Uint16Array(a);s=new DataView(i.buffer);for(let t=0;t<3;++t){n[e.idx[t]].decoded=!0;const r=n[e.idx[t]].type;if(2==n[t].type)for(let e=0;e<l;++e){const n=m[t][e];for(let e=0;e<a;++e)g[e]=s.getUint16(n+2*e*r,!0);for(let e=0;e<a;++e)s.setFloat32(n+2*e*r,ee(g[e]),!0)}}}(u,d,l,f,h,r);for(let t=0;t<l.length;++t){const n=l[t];if(!n.decoded){if(2!==n.compression)throw new Error("EXRLoader.parse: unsupported channel compression");{let o=0,i=0;for(let s=0;s<e.lines;++s){let e=d[t][o];for(let t=0;t<n.width;++t){for(let t=0;t<2*n.type;++t)r[e++]=w[i+t*n.width*n.height];i++}o++}}}}return new DataView(r.buffer)}function Y(e,t){const n=new Uint8Array(e);let r=0;for(;0!=n[t.value+r];)r+=1;const o=(new TextDecoder).decode(n.slice(t.value,t.value+r));return t.value=t.value+r+1,o}function j(e,t){const n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function G(e,t){const n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function q(e,t){const n=e[t.value];return t.value=t.value+1,n}function $(e,t){const n=e.getUint8(t.value);return t.value=t.value+1,n}const J=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function K(e,t){const n=e.getFloat32(t.value,!0);return t.value+=4,n}function Q(e,t){return l.toHalfFloat(K(e,t))}function ee(e){const t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}function te(e,t){const n=e.getUint16(t.value,!0);return t.value+=2,n}function ne(e,t){return ee(te(e,t))}function re(e,t,n,r,o){return"string"===r||"stringvector"===r||"iccProfile"===r?function(e,t,n){const r=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,r}(t,n,o):"chlist"===r?function(e,t,n,r){const o=n.value,i=[];for(;n.value<o+r-1;){const r=Y(t,n),o=j(e,n),s=$(e,n);n.value+=3;const a=j(e,n),l=j(e,n);i.push({name:r,pixelType:o,pLinear:s,xSampling:a,ySampling:l})}return n.value+=1,i}(e,t,n,o):"chromaticities"===r?function(e,t){return{redX:K(e,t),redY:K(e,t),greenX:K(e,t),greenY:K(e,t),blueX:K(e,t),blueY:K(e,t),whiteX:K(e,t),whiteY:K(e,t)}}(e,n):"compression"===r?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][$(e,t)]}(e,n):"box2i"===r?function(e,t){return{xMin:G(e,t),yMin:G(e,t),xMax:G(e,t),yMax:G(e,t)}}(e,n):"lineOrder"===r?function(e,t){return["INCREASING_Y"][$(e,t)]}(e,n):"float"===r?K(e,n):"v2f"===r?function(e,t){return[K(e,t),K(e,t)]}(e,n):"v3f"===r?function(e,t){return[K(e,t),K(e,t),K(e,t)]}(e,n):"int"===r?j(e,n):"rational"===r?function(e,t){return[j(e,t),G(e,t)]}(e,n):"timecode"===r?function(e,t){return[G(e,t),G(e,t)]}(e,n):"preview"===r?(n.value+=o,"skipped"):void(n.value+=o)}const oe=new DataView(e),ie=new Uint8Array(e),se={value:0},ae=function(e,t,n){const r={};if(20000630!=e.getUint32(0,!0))throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");r.version=e.getUint8(4);const o=e.getUint8(5);r.spec={singleTile:!!(2&o),longName:!!(4&o),deepFormat:!!(8&o),multiPart:!!(16&o)},n.value=8;let i=!0;for(;i;){const o=Y(t,n);if(0==o)i=!1;else{const i=Y(t,n),s=re(e,t,n,i,G(e,n));void 0===s?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${i}'.`):r[o]=s}}if(0!=(-5&o))throw console.error("THREE.EXRHeader:",r),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return r}(oe,e,se),le=function(e,a,l,c,u){const f={size:0,viewer:a,array:l,offset:c,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:n};switch(e.compression){case"NO_COMPRESSION":f.lines=1,f.uncompress=X;break;case"RLE_COMPRESSION":f.lines=1,f.uncompress=V;break;case"ZIPS_COMPRESSION":f.lines=1,f.uncompress=F;break;case"ZIP_COMPRESSION":f.lines=16,f.uncompress=F;break;case"PIZ_COMPRESSION":f.lines=32,f.uncompress=H;break;case"PXR24_COMPRESSION":f.lines=16,f.uncompress=W;break;case"DWAA_COMPRESSION":f.lines=32,f.uncompress=Z;break;case"DWAB_COMPRESSION":f.lines=256,f.uncompress=Z;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}if(f.scanlineBlockSize=f.lines,1==f.type)switch(u){case r:f.getter=ne,f.inputSize=2;break;case t:f.getter=te,f.inputSize=2}else{if(2!=f.type)throw new Error("EXRLoader.parse: unsupported pixelType "+f.type+" for "+e.compression+".");switch(u){case r:f.getter=K,f.inputSize=4;break;case t:f.getter=Q,f.inputSize=4}}f.blockCount=(e.dataWindow.yMax+1)/f.scanlineBlockSize;for(let e=0;e<f.blockCount;e++)J(a,c);f.outputChannels=3==f.channels?4:f.channels;const h=f.width*f.height*f.outputChannels;switch(u){case r:f.byteArray=new Float32Array(h),f.channels<f.outputChannels&&f.byteArray.fill(1,0,h);break;case t:f.byteArray=new Uint16Array(h),f.channels<f.outputChannels&&f.byteArray.fill(15360,0,h);break;default:console.error("THREE.EXRLoader: unsupported type: ",u)}return f.bytesPerLine=f.width*f.inputSize*f.channels,4==f.outputChannels?(f.format=o,f.colorSpace=n):(f.format=i,f.colorSpace=s),f}(ae,oe,ie,se,this.type),ce={value:0},ue={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<le.height/le.scanlineBlockSize;e++){const t=G(oe,se);le.size=G(oe,se),le.lines=t+le.scanlineBlockSize>le.height?le.height-t:le.scanlineBlockSize;const n=le.size<le.lines*le.bytesPerLine?le.uncompress(le):X(le);se.value+=le.size;for(let t=0;t<le.scanlineBlockSize;t++){const r=t+e*le.scanlineBlockSize;if(r>=le.height)break;for(let e=0;e<le.channels;e++){const o=ue[ae.channels[e].name];for(let i=0;i<le.width;i++){ce.value=(t*(le.channels*le.width)+e*le.width+i)*le.inputSize;const s=(le.height-1-r)*(le.width*le.outputChannels)+i*le.outputChannels+o;le.byteArray[s]=le.getter(n,ce)}}}}return{header:ae,width:le.width,height:le.height,data:le.byteArray,format:le.format,colorSpace:le.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,(function(e,n){e.colorSpace=n.colorSpace,e.minFilter=a,e.magFilter=a,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,n)}),n,r)}}export{u as EXRLoader};
