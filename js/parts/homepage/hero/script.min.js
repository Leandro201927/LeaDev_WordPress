import*as e from"https://cdnjs.cloudflare.com/ajax/libs/three.js/0.156.1/three.module.min.js";import{GLTFLoader as t}from"https://cdn.jsdelivr.net/gh/Leandro201927/LeaInnova_CDN@master/threejs/loaders/GLTFLoader.js";import{DRACOLoader as n}from"https://cdn.jsdelivr.net/gh/Leandro201927/LeaInnova_CDN@master/threejs/loaders/DRACOLoader.js";import{EffectComposer as o}from"https://cdn.jsdelivr.net/gh/Leandro201927/LeaInnova_CDN@master/threejs/postprocessing/EffectComposer.js";import{RenderPass as i}from"https://cdn.jsdelivr.net/gh/Leandro201927/LeaInnova_CDN@master/threejs/postprocessing/RenderPass.js";import{UnrealBloomPass as a}from"https://cdn.jsdelivr.net/gh/Leandro201927/LeaInnova_CDN@master/threejs/postprocessing/UnrealBloomPass.js";import{ShaderPass as r}from"https://cdn.jsdelivr.net/gh/Leandro201927/LeaInnova_CDN@master/threejs/postprocessing/ShaderPass.js";import{GammaCorrectionShader as s}from"https://cdn.jsdelivr.net/gh/Leandro201927/LeaInnova_CDN@master/threejs/shaders/GammaCorrectionShader.js";import{RGBShiftShader as c}from"https://cdn.jsdelivr.net/gh/Leandro201927/LeaInnova_CDN@master/threejs/shaders/RGBShiftShader.js";import{FXAAShader as l}from"https://cdn.jsdelivr.net/gh/Leandro201927/LeaInnova_CDN@master/threejs/shaders/FXAAShader.js";import{RoomEnvironment as m}from"https://cdn.jsdelivr.net/gh/Leandro201927/LeaInnova_CDN@master/threejs/environments/RoomEnvironment.js";import*as d from"https://cdnjs.cloudflare.com/ajax/libs/tween.js/21.0.0/tween.esm.min.js";registerComponent((async()=>{const u=new URL(import.meta.url),p=new URLSearchParams(u.search),h=p.get("key"),g=p.get("templateUrl");p.get("componentName");const f=document.getElementById(h),w=f.querySelector(".background-gradient-mobile"),v=f.querySelector(".slider-container"),y=f.querySelector(".slide-1"),S=f.querySelector(".slide-2 .slider-image-supercontainer");new AccordionController(y);const C=new SliderController(v),L=new SliderImageController(S),x=new e.Clock,b=new e.Vector3;function M(){return window.innerWidth>1366?"desktopL":window.innerWidth<=1366&&window.innerWidth>1024?"desktopM":window.innerWidth<=1024&&window.innerWidth>768?"desktopS":window.innerWidth<=768&&window.innerWidth>425?"tablet":"mobile"}let A=M();console.log("actualscrensize",A);let j,E=1;const z={desktopL:{position:{x:9.89600658416748,y:13.16525993347168,z:13.140523910522461},frustrumSizeCamera:6},desktopM:{position:{x:9.89600658416748,y:13.41525993347168,z:13.640523910522461},frustrumSizeCamera:5.5},desktopS:{position:{x:13.39600658416748,y:12.66525993347168,z:13.640523910522461},frustrumSizeCamera:10},tablet:{position:{x:13.89600658416748,y:12.66525993347168,z:13.640523910522461},frustrumSizeCamera:10},mobile:{position:{x:13.89600658416748,y:12.66525993347168,z:13.640523910522461},frustrumSizeCamera:10}};let P;const T={desktopL:{position:{x:5.167432249854422,y:9,z:13.312374668985601},lookAt:{x:-4.5,y:-.5,z:0},frustrumSizeCamera:2},desktopM:{position:{x:5.167432249854422,y:9,z:13.312374668985601},lookAt:{x:-4.5,y:-.5,z:0},frustrumSizeCamera:2},desktopS:{position:{x:5.167432249854422,y:9,z:13.312374668985601},lookAt:{x:-3.5,y:-1.5,z:0},frustrumSizeCamera:3},tablet:{position:{x:5.167432249854422,y:9,z:13.312374668985601},lookAt:{x:-3.5,y:-1.5,z:0},frustrumSizeCamera:3},mobile:{position:{x:5.167432249854422,y:9,z:13.312374668985601},lookAt:{x:-3.5,y:-1.15,z:0},frustrumSizeCamera:2.5}},R=f.querySelector("canvas#webgl1"),I=f.querySelector("canvas#webgl2");let W=0;C.on("onslidechange",(function(e){if(0===e&&1===W){const t=()=>{R.style.opacity=1,E=1,I.removeEventListener("transitionend",t)};I.addEventListener("transitionend",t);let n={value:z[A].frustrumSizeCamera+1.5},o={value:z[A].frustrumSizeCamera};new d.Tween(n).to(o,1e3).easing(d.Easing.Quadratic.InOut).onUpdate((function(){const e=n.value/2,t=R.clientWidth/R.clientHeight;j.left=-e*t,j.right=e*t,j.top=e,j.bottom=-e,j.updateProjectionMatrix()})).start();let i={value:T[A].frustrumSizeCamera},a={value:T[A].frustrumSizeCamera+.5};new d.Tween(i).to(a,1e3).easing(d.Easing.Quadratic.InOut).onUpdate((function(){const e=i.value/2,t=R.clientWidth/R.clientHeight;P.left=-e*t,P.right=e*t,P.top=e,P.bottom=-e,P.updateProjectionMatrix()})).start(),I.style.opacity=0,W=e}if(1===e){if(0===W){const e=()=>{I.style.opacity=1,E=2,R.removeEventListener("transitionend",e)};R.addEventListener("transitionend",e);let t={value:z[A].frustrumSizeCamera},n={value:z[A].frustrumSizeCamera+1.5};new d.Tween(t).to(n,1e3).easing(d.Easing.Quadratic.InOut).onUpdate((function(){const e=t.value/2,n=R.clientWidth/R.clientHeight;j.left=-e*n,j.right=e*n,j.top=e,j.bottom=-e,j.updateProjectionMatrix()})).start();let o={value:T[A].frustrumSizeCamera+.5},i={value:T[A].frustrumSizeCamera};new d.Tween(o).to(i,1e3).easing(d.Easing.Quadratic.InOut).onUpdate((function(){const e=o.value/2,t=R.clientWidth/R.clientHeight;P.left=-e*t,P.right=e*t,P.top=e,P.bottom=-e,P.updateProjectionMatrix()})).start(),R.style.opacity=0}else if(2===W){if(G("close"),"desktopS"!==A&&"tablet"!==A&&"mobile"!==A){const e={value:T[A].frustrumSizeCamera-.5},t={value:T[A].frustrumSizeCamera};new d.Tween(e).to(t,1e3).easing(d.Easing.Quadratic.InOut).onUpdate((function(){const t=e.value/2,n=R.clientWidth/R.clientHeight;P.left=-t*n,P.right=t*n,P.top=t,P.bottom=-t,P.updateProjectionMatrix()})).start()}new d.Tween(b).to({y:T[A].lookAt.y},1e3).easing(d.Easing.Quadratic.InOut).onUpdate((function(){})).start()}W=e}if(2===e){if(G("open",_),"desktopS"!==A&&"tablet"!==A&&"mobile"!==A){const e={value:T[A].frustrumSizeCamera},t={value:T[A].frustrumSizeCamera-.5};new d.Tween(e).to(t,1e3).easing(d.Easing.Quadratic.InOut).onUpdate((function(){const t=e.value/2,n=R.clientWidth/R.clientHeight;P.left=-t*n,P.right=t*n,P.top=t,P.bottom=-t,P.updateProjectionMatrix()})).start()}"desktopS"!==A&&"tablet"!==A&&"mobile"!==A||new d.Tween(b).to({y:b.y+.5},1e3).easing(d.Easing.Quadratic.InOut).onUpdate((function(){})).start(),W=e}}));let _="movier";L.on("preslidechange",(e=>{$();const t=S.querySelector(`.slider-image-container-${e}`);console.log(e,t.classList),t.classList.contains("movier")?_="movier":t.classList.contains("cproc")&&(_="cproc"),console.log(_)})),L.on("slidechange",(e=>{Y(_)}));const k={width:I.clientWidth,height:I.clientHeight},O=new e.WebGLRenderer({canvas:R,antialias:!0,alpha:!0});O.setSize(k.width,k.height),O.setPixelRatio(window.devicePixelRatio),O.outputColorSpace=e.SRGBColorSpace,O.physicallyCorrectLights=!0,O.toneMapping=e.LinearToneMapping,O.toneMappingExposure=1.04,O.setSize(k.width,k.height),O.setPixelRatio(window.devicePixelRatio);const B=new e.PMREMGenerator(O),U=new e.TextureLoader,F=new n;F.setDecoderPath(`${g}/js/lib/draco/`);const H=new t;H.setDRACOLoader(F);const D=(t,n=!1)=>new Promise(((o,i)=>{(new e.TextureLoader).load(t,(t=>{t.flipY=n,t.colorSpace=e.SRGBColorSpace,o(t)}),void 0,(e=>i(e)))}));let N,Q;const{RAF_2:V,preLoadResources:q,enable3rdSectionAnimations:G,projectImgOrVideoInLaptopScreen:Y,shutDownLaptopScreen:$}=function(){let t,n,m,u,p,h,f,w,v,y={},S=["ScreenPlateAction","ScreenAction.001","ALogoAction"],C=!0;const j=new e.MeshPhongMaterial({emissive:65423,emissiveIntensity:1.8,transparent:!0,opacity:0}),E=new e.Scene;function z(e){f&&(e?(f.visible=!1,C=!1):(f.visible=!0,C=!0))}function R(t){if(!t)return;let n;if("movier"===t){const t=document.createElement("video");t.src=`${g}/assets/3d/homepage/movier.mp4`,t.crossOrigin="anonymous",t.play(),t.muted=!0,v=t,n=new e.VideoTexture(t),z(!1)}else{const t=document.getElementById("cproc-img");v=t,n=(new e.TextureLoader).load(t.src),z(!0)}n.minFilter=e.LinearFilter,n.magFilter=e.LinearFilter,n.flipY=!1,e.ShaderLib.customVideoShader={uniforms:{tDiffuse:{type:"t",value:null},brightness:{type:"f",value:0},contrast:{type:"f",value:0}},vertexShader:"\n          varying vec2 vUv;\n          void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          }\n        ",fragmentShader:"\n          uniform sampler2D tDiffuse;\n          uniform float brightness;\n          uniform float contrast;\n          varying vec2 vUv;\n          void main() {\n            vec4 color = texture2D(tDiffuse, vUv);\n            color.rgb += brightness;\n            if (contrast > 0.0) {\n              color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\n            } else {\n              color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\n            }\n            gl_FragColor = color;\n          }\n        "};const o=new e.ShaderMaterial({uniforms:e.UniformsUtils.clone(e.ShaderLib.customVideoShader.uniforms),vertexShader:e.ShaderLib.customVideoShader.vertexShader,fragmentShader:e.ShaderLib.customVideoShader.fragmentShader});o.uniforms.tDiffuse.value=n,o.uniforms.brightness.value=-.3,o.uniforms.contrast.value=-.4,w.material=o}const _={x:0,y:0};let O=null;window.addEventListener("mousemove",(e=>{_.x=e.clientX/window.innerWidth*2-1,_.y=-e.clientY/window.innerHeight*2+1}));const B=new e.Raycaster,F=new e.Vector2;let D=null;return window.addEventListener("mousemove",(e=>{F.x=e.clientX/window.innerWidth*2-1,F.y=-e.clientY/window.innerHeight*2+1}),!1),window.addEventListener("click",(()=>{B.setFromCamera(F,P);const e=B.intersectObjects(E.children,!0);for(let t=0;t<e.length;t++)if("RaycastHoverArrowNext"===e[t].object.name)L.nextPage(),console.log("arrownext");else if("RaycastHoverArrowPrev"===e[t].object.name)L.prevPage(),console.log("arrowprev");else if("RaycastHoverRepeat"===e[t].object.name)try{v.pause(),v.currentTime="0",v.play()}catch(e){console.warn("No es un video.")}}),!1),{RAF_2:function(){t&&(t.scene.rotation.y+=64e-5*(_.x-18*t.scene.rotation.y-0),_.y,b.y,P.lookAt(b));let e=null;B.setFromCamera(F,P);const o=B.intersectObjects(E.children,!0);for(let t=0;t<o.length;t++)if("RaycastHoverArrowPrev"===o[t].object.name||"RaycastHoverArrowNext"===o[t].object.name||"RaycastHoverRepeat"===o[t].object.name){document.body.style.cursor="pointer";switch(o[t].object.name){case"RaycastHoverArrowPrev":e=h;break;case"RaycastHoverArrowNext":e=p;break;case"RaycastHoverRepeat":C||(document.body.style.cursor="default"),e=f}break}e?D!==e&&(!D||O&&O.isPlaying()||(O=new d.Tween(D.scale).to({x:1,y:1,z:1},250).easing(d.Easing.Quadratic.Out).start()),D=e,O=new d.Tween(D.scale).to({x:1.15,y:1.15,z:1.15},250).easing(d.Easing.Quadratic.Out).start()):(document.body.style.cursor="default",!D||O&&O.isPlaying()||(O=new d.Tween(D.scale).to({x:1,y:1,z:1},500).easing(d.Easing.Quadratic.Out).onComplete((()=>{D=null})).start())),m&&m.render(),n&&n.update(x.getDelta())},preLoadResources:function(){const d=U.load(`${g}/assets/3d/homepage/laptop_4k_baked.jpg`,(()=>{d.flipY=!1,d.colorSpace=e.SRGBColorSpace})),v=new e.MeshPhongMaterial({emissive:65423,emissiveIntensity:1.8});new Promise(((n,o)=>{H.load(`${g}/assets/3d/homepage/105-laptop.glb`,(o=>{t=o;let i=o.scene.children.length,a=0;o.animations&&(u=o.animations.filter((e=>S.includes(e.name)))),o.scene.traverse((t=>{if(a++,t instanceof e.Mesh){if(console.log(t.name),t.material=new e.MeshBasicMaterial({map:d}),"Plane002_1"===t.name&&(t.material=new e.MeshStandardMaterial({color:3947580,envMap:Q})),"Plane002_2"===t.name&&(t.material=v),"ALogo"===t.name&&(t.material=v),"RaycastHoverArrowPrev"!==t.name&&"RaycastHoverArrowNext"!==t.name&&"RaycastHoverRepeat"!==t.name||(t.material=new e.MeshBasicMaterial({color:16777215,transparent:!0,opacity:0})),"ArrowNext"===t.name||"ArrowPrev"===t.name||"Repeat"===t.name){switch(t.name){case"ArrowNext":p=t;break;case"ArrowPrev":h=t;break;case"Repeat":f=t}t.material=j}"Screen"===t.name&&(w=t)}a===i&&n()})),E.add(o.scene)}))})).then((()=>{n=new e.AnimationMixer(t.scene),n.timeScale=2,u.forEach((t=>{let o=n.clipAction(t);o.enabled=!0,o.setLoop(e.LoopOnce),o.clampWhenFinished=!0,o.setEffectiveTimeScale(1),o.setEffectiveWeight(1),y[t.name]={action:o}}))})),window.addEventListener("resize",(function(){k.width=I.clientWidth,k.height=I.clientHeight,A=M();let t=new e.Vector3(T[A].position.x,T[A].position.y,T[A].position.z);P.position.copy(t),b.x=T[A].lookAt.x,b.y="desktopS"!==A&&"tablet"!==A&&"mobile"!==A||2!==W?T[A].lookAt.y:T[A].lookAt.y+.5,b.z=T[A].lookAt.z,P.lookAt(b.x,b.y,b.z);const n=k.width/k.height,o=T[A].frustrumSizeCamera/2,i=-o*n,a=o*n,r=o,s=-o;P.left=i,P.right=a,P.top=r,P.bottom=s,P.near=-100,P.far=1e3,P.updateProjectionMatrix(),x.setSize(k.width,k.height),m.setSize(k.width,k.height),x.setPixelRatio(window.devicePixelRatio)}));const C=k.width/k.height,L=T[A].frustrumSizeCamera/2;P=new e.OrthographicCamera(-L*C,L*C,L,-L,-100,1e3),b.x=T[A].lookAt.x,b.y=T[A].lookAt.y,b.z=T[A].lookAt.z,P.position.set(T[A].position.x,T[A].position.y,T[A].position.z),P.rotation.order="XYZ",P.rotation.set(0,0,0),P.lookAt(b.x,b.y,b.z),E.add(P);const x=new e.WebGLRenderer({canvas:I,antialias:!0});x.setSize(k.width,k.height),x.setPixelRatio(window.devicePixelRatio),x.outputColorSpace=e.SRGBColorSpace,x.physicallyCorrectLights=!0,x.toneMapping=e.LinearToneMapping,x.toneMappingExposure=1.04,m=new o(x),m.setSize(k.width,k.height),m.setPixelRatio(1);const z=new i(E,P),R=new a;R.strength=.22,R.radius=.2,R.threshold=1;const _=new r(s),O=new r(l);O.uniforms.resolution.value.set(1/k.width,1/k.height),O.material.uniforms.resolution.value.x=1/k.width,O.material.uniforms.resolution.value.y=1/k.height;const B=new r(c);B.uniforms.amount.value=.0015,B.uniforms.angle.value=0,m.addPass(z),m.addPass(R),m.addPass(_)},enable3rdSectionAnimations:function(t,o=null){if("open"===t){i=y,Object.entries(i).forEach((([e,t])=>{const n=t.action;n.reset(),n.setEffectiveTimeScale(1),n.play()})),w.material=new e.MeshBasicMaterial({color:0});const t=e=>{"ScreenAction.001"===e.action.getClip().name&&(new d.Tween(j).to({opacity:1,emissiveIntensity:1.8},250).easing(d.Easing.Quadratic.Out).start(),w&&R(o),n.removeEventListener("finished",t))};n.addEventListener("finished",t)}else"close"===t&&(!function(e){Object.entries(e).forEach((([e,t])=>{const n=t.action;let o=n.getClip().duration;n.reset(),n.time=o,n.setEffectiveTimeScale(-1),n.play()}))}(y),new d.Tween(j).to({opacity:0,emissiveIntensity:0},250).easing(d.Easing.Quadratic.Out).start(),w&&(w.material=new e.MeshBasicMaterial({color:0})));var i},projectImgOrVideoInLaptopScreen:R,shutDownLaptopScreen:function(){w.material=new e.MeshBasicMaterial({color:2632740})}}}(),{RAF_1:X}=await async function(t){let n,u;const p=new e.Scene,h=await D(`${g}/assets/3d/homepage/delivery_machine_4k_baked.jpg`),f=await D(`${g}/assets/3d/homepage/crate_baked.jpg`),v=new e.MeshBasicMaterial({map:f}),y=new e.MeshBasicMaterial({map:h});U.load(`${g}/assets/3d/homepage/kloppenheim_02_4k.jpg`,(function(t){t.mapping=e.EquirectangularReflectionMapping,t.colorSpace=e.SRGBColorSpace,Q=t})),N=B.fromScene(new m,.04).texture;const S=U.load(`${g}/assets/3d/homepage/white.png`,(t=>{h.flipY=!1,h.colorSpace=e.SRGBColorSpace})),L=new e.ShaderMaterial({uniforms:{texture1:{type:"t",value:S},texture2:{type:"t",value:h},transition:{type:"f",value:0}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform sampler2D texture1;\n        uniform sampler2D texture2;\n        uniform float transition;\n        varying vec2 vUv;\n        void main() {\n          vec4 tex1 = texture2D(texture1, vUv);\n          vec4 tex2 = texture2D(texture2, vUv);\n          gl_FragColor = mix(tex1, tex2, transition);\n          gl_FragColor.a = 1.0; // Asegura que la salida no sea transparente\n        }\n      "}),b=new e.MeshPhongMaterial({emissive:65423,emissiveIntensity:0}),E=new e.MeshPhongMaterial({emissive:65423,emissiveIntensity:1,transparent:!0,opacity:0}),P=[];let T,I,W,_,k={},F={},V=["SpawnUpperConveyorBelt","SpawnLowerConveyorBelt","SpawnLTransformMachine","SpawnTransformMachine","SpawnALogo","SpawnALogoContainer","SpawnTuNegocioCover","SpawnTuNegocio"],q={},G=["CycleTranslateUpperConveyorBelt","CycleTranslateLowerConveyorBelt","CicleFloatingLogoContainer","CicleFloatingLogo","CicleFloatingTuNegocioCover","CicleFloatingTuNegocio"],Y={},$=["CrateAction","MegaphoneAction.001","AIBotAction","WWW_InternetAction"];function X(){let e=["MegaphoneAction.001","AIBotAction","WWW_InternetAction"],t=0;function n(){const o=i=>{"CrateAction"===i.action.getClip().name&&(u.removeEventListener("finished",o),function(){const o=i=>{const a=i.action.getClip().name;"AIBotAction"!==a&&"WWW_InternetAction"!==a&&"MegaphoneAction.001"!==a||(u.removeEventListener("finished",o),t=t+1>e.length-1?0:t+1,n())};u.addEventListener("finished",o),se(Y,e[t])}())};u.addEventListener("finished",o),se(Y,"CrateAction")}n()}const Z=20.8,J=100,K=28.6,ee=new e.PointLight(255,1e4,100);ee.position.set(Z,J,K),p.add(ee);const te=new e.Raycaster,ne=new e.Vector2,oe=new e.Vector2;let ie,ae;function re(e){Object.entries(e).forEach((([e,t])=>{const n=t.action;n.reset(),n.setEffectiveTimeScale(1),n.play()}))}function se(e,t){console.log("intentando reproducir accion",t);const n=e[t].action;n.reset(),n.setEffectiveTimeScale(1),n.play()}document.addEventListener("mousemove",(function(e){ne.x=e.clientX/window.innerWidth*2-1,ne.y=-e.clientY/window.innerHeight*2+1,oe.x=e.clientX,oe.y=e.clientY}),!1),new Promise(((t,o)=>{R.style.opacity=0,H.load(`${g}/assets/3d/homepage/delivery machine addon + animation.glb`,(o=>{n=o;let i=o.scene.children.length,a=0;if(o.animations&&(T=o.animations.filter((e=>"PenroseInitRotate"===e.name)),I=o.animations.filter((e=>V.includes(e.name))),W=o.animations.filter((e=>G.includes(e.name))),_=o.animations.filter((e=>$.includes(e.name)))),o.cameras.length){const t=o.cameras[0];let n=new e.Vector3(z[A].position.x,z[A].position.y,z[A].position.z);console.log("camera1Positions[actualScreenSize]",z[A],A);let i=t.quaternion;j.position.copy(n),j.quaternion.copy(i)}o.scene.traverse((n=>{if(a++,n instanceof e.Mesh){n.material=y,(n.name.includes("Crate")||n.name.includes("Megaphone")||n.name.includes("AIBot")||n.name.includes("WWW_Internet"))&&(n.material=v),"TransformMachine_1"===n.name&&(ie=n),"LTransformMachine_3"===n.name&&(ae=n),"TransformMachine_1"!==n.name&&"LTransformMachine_3"!==n.name||(n.material=new e.MeshStandardMaterial({color:65423,transparent:!0,opacity:.06,envMap:N,envMapIntensity:1,depthWrite:!1,side:e.FrontSide})),"WWW_Internet_3"!==n.name&&"AIBot_3"!==n.name||(n.material=new e.MeshBasicMaterial({color:0})),n.name.includes("PenroseTriangle")&&("PenroseTriangle_1"===n.name?n.material=L:n.material=b),"LowerConveyorBelt_1"!==n.name&&"UpperConveyorBelt_1"!==n.name||(n.receiveShadow=!0,n.material=new e.MeshBasicMaterial({color:3355443})),"Megaphone_2"!==n.name&&"AIBot_2"!==n.name&&"WWW_Internet_2"!==n.name||(n.material=new e.MeshPhongMaterial({emissive:65423,emissiveIntensity:1.5})),["ALogo","UpperConveyorBelt_2","LowerConveyorBelt_2","TransformMachine_2","TuNegocioText","LTransformMachine_2","Crate_2"].includes(n.name)&&(n.material=E),["Floor","AIBot","WWW_Internet","Megaphone","Crate","LowerConveyorBelt","UpperConveyorBelt"].some((e=>n.name.includes(e)))&&(n.material.transparent=!0,n.material.opacity=0,P.push(n))}a===i&&t()})),p.add(o.scene)}))})).then((()=>{t(),u=new e.AnimationMixer(n.scene),u.timeScale=1.25,T.forEach((t=>{let n=u.clipAction(t);n.enabled=!0,n.setLoop(e.LoopOnce),n.clampWhenFinished=!0,n.setEffectiveTimeScale(1),n.setEffectiveWeight(1),k[t.name]={action:n}})),I.forEach((t=>{let n=u.clipAction(t);n.enabled=!0,n.setLoop(e.LoopOnce),n.clampWhenFinished=!0,n.setEffectiveTimeScale(1),n.setEffectiveWeight(1),F[t.name]={action:n}})),W.forEach((t=>{let n=u.clipAction(t);n.enabled=!0,n.setLoop(e.LoopRepeat),n.clampWhenFinished=!0,n.setEffectiveTimeScale(1),n.setEffectiveWeight(1),q[t.name]={action:n}})),_.forEach((t=>{let n=u.clipAction(t);n.enabled=!0,n.setLoop(e.LoopOnce),n.clampWhenFinished=!0,n.setEffectiveTimeScale(1),n.setEffectiveWeight(1),Y[t.name]={action:n}})),setTimeout((()=>{document.querySelector("header").style.transform="translateY(0px)",u.addEventListener("finished",(function(e){const t=e.action.getClip().name;"PenroseInitRotate"===t?(w.classList.add("show"),new d.Tween(L.uniforms.transition).to({value:1},500).easing(d.Easing.Quadratic.InOut).onComplete((()=>{})).start(),new d.Tween(b).to({emissiveIntensity:1.25},500).easing(d.Easing.Quadratic.InOut).onComplete((()=>{})).start(),P.forEach((e=>{new d.Tween(e.material).to({opacity:1},700).easing(d.Easing.Quadratic.InOut).onComplete((()=>{})).start()}))):"SpawnLTransformMachine"===t&&(re(q),C.renderFirstSlide())})),re(k),re(F);let e={value:45},t={value:z[A].frustrumSizeCamera};new d.Tween(e).to(t,1500).easing(d.Easing.Quadratic.InOut).onUpdate((function(){const t=e.value/2;j.left=-t*le,j.right=t*le,j.top=t,j.bottom=-t,j.updateProjectionMatrix()})).onComplete((function(){X()})).start()}),1e3);const o=loaderHandler.getLoaderParentElement();new d.Tween(o.style).to({opacity:0},500).easing(d.Easing.Quadratic.InOut).onComplete((()=>{o.style.display="none",R.style.opacity=1})).start()}));const ce={width:R.clientWidth,height:R.clientHeight};window.addEventListener("resize",(function(){ce.width=R.clientWidth,ce.height=R.clientHeight,A=M();let t=new e.Vector3(z[A].position.x,z[A].position.y,z[A].position.z);j.position.copy(t);const n=ce.width/ce.height,o=z[A].frustrumSizeCamera/2,i=-o*n,a=o*n,r=o,s=-o;j.left=i,j.right=a,j.top=r,j.bottom=s,j.near=-100,j.far=1e3,j.updateProjectionMatrix(),O.setSize(ce.width,ce.height),de.setSize(ce.width,ce.height),O.setPixelRatio(window.devicePixelRatio)})),new e.Vector3;const le=R.clientWidth/R.clientHeight,me=22.5;j=new e.OrthographicCamera(-22.5*le,me*le,me,-22.5,-100,1e3),p.add(j);const de=new o(O);de.setPixelRatio(1);const ue=new i(p,j),pe=new a;pe.strength=.29,pe.radius=1,pe.threshold=.754;const he=new r(s),ge=new r(l);ge.uniforms.resolution.value.set(1/ce.width,1/ce.height),ge.material.uniforms.resolution.value.x=1/ce.width,ge.material.uniforms.resolution.value.y=1/ce.height;const fe=new r(c);fe.uniforms.amount.value=.0015,fe.uniforms.angle.value=0,de.addPass(ue),de.addPass(pe),de.addPass(he),de.addPass(ge);let we,ve=!0,ye=!0;const Se=new e.Color(65423),Ce=new e.Color(11270143),Le={t:0};return new d.Tween(Le).to({t:1},0).onUpdate((function(){ie.material.color.lerpColors(Se,Ce,Le.t),ae.material.color.lerpColors(Se,Ce,Le.t)})),new d.Tween(Le).to({t:0},100).onUpdate((function(){ie.material.color.lerpColors(Se,Ce,Le.t),ae.material.color.lerpColors(Se,Ce,Le.t)})),{RAF_1:function(){let e=oe.y/window.innerHeight*200-100;ee.position.setY(e),we=function(){te.setFromCamera(ne,j);const e=te.intersectObjects(p.children);let t=!1;for(let n=0;n<e.length;n++)if("PenroseTriangle_1"===e[n].object.name||"PenroseTriangle_2"===e[n].object.name||e[n].object.name.includes("TransformMachine")||e[n].object.name.includes("LTransformMachine")){t=!0;break}return t}(),!1===we?ve&&(ve=!1,new d.Tween(ee).to({intensity:0},250).easing(d.Easing.Quadratic.InOut).onComplete((()=>{ve=!0})).start()):!0===we&&ye&&(ye=!1,new d.Tween(ee).to({intensity:1e4},250).easing(d.Easing.Quadratic.InOut).onComplete((()=>{ye=!0})).start()),de.render(),u&&u.update(x.getDelta())}}}(q),Z=()=>{d.update(),1===E&&X?X():2===E&&V&&V(),window.requestAnimationFrame(Z)};Z()}));
